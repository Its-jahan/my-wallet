# کیف پول من (My Wallet)

یک برنامه Next.js برای مدیریت دارایی‌ها و هزینه‌های ارزی با رابط کاربری فارسی و راست‌به‌چپ. برنامه نرخ‌های لحظه‌ای دلار، یورو و تتر را از سرویس [ناوسان](https://api.navasan.tech/) دریافت می‌کند، معادل تومانی را محاسبه می‌کند و داده‌ها را در مرورگر و در صورت تمایل در Supabase نگه‌داری می‌کند.

## شروع سریع

```bash
pnpm install
pnpm dev
```

> می‌توانید به‌جای `pnpm` از `npm` یا `yarn` نیز استفاده کنید.

سپس برنامه در آدرس [http://localhost:3000](http://localhost:3000) در دسترس خواهد بود.

## متغیرهای محیطی

برای اجرای کامل برنامه یک فایل `.env.local` در ریشه پروژه ایجاد کنید و متغیرهای زیر را مقداردهی نمایید:

```env
NAVASAN_API_KEY=your_navasan_api_key
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=public-anon-key
```

- مقدار `NAVASAN_API_KEY` الزامی است و برای فراخوانی API ناوسان استفاده می‌شود.
- مقادیر Supabase اختیاری هستند. در صورت عدم تنظیم، برنامه فقط از LocalStorage برای ذخیره‌سازی استفاده می‌کند.

## همگام‌سازی با Supabase

اگر قصد دارید داده‌ها در فضای ابری ذخیره شوند:

1. یک پروژه Supabase ایجاد کنید.
2. دو جدول با ساختار مشابه زیر بسازید:
   - `wallet_holdings`: ستون‌های `id`, `title`, `currency`, `amount`, `irt_value`, `created_at`
   - `wallet_expenses`: ستون‌های `id`, `description`, `currency`, `amount`, `irt_value`, `expense_at`, `created_at`
3. قوانین RLS را متناسب با نیاز خود تنظیم کنید (برای تست می‌توانید آن‌ها را غیرفعال کنید).
4. مقادیر `NEXT_PUBLIC_SUPABASE_URL` و `NEXT_PUBLIC_SUPABASE_ANON_KEY` را در `.env.local` قرار دهید.

پس از راه‌اندازی، هر بار که دارایی یا هزینه‌ای ثبت، حذف یا وارد/خارج شود با جداول مربوطه همگام می‌گردد.

## استقرار بر روی Vercel

1. مخزن را در GitHub قرار دهید.
2. پروژه را روی Vercel ایمپورت کنید.
3. در تنظیمات Vercel متغیرهای محیطی بالا را تعریف کنید.
4. یک بار Build انجام دهید. Vercel به‌صورت خودکار از اسکریپت‌های `build` و `start` استفاده می‌کند.

## امکانات کلیدی

- **رابط کاربری RTL و فونت فارسی Vazirmatn**
- **به‌روزرسانی نرخ‌ها هر ۴۵ ثانیه با SWR**
- **هشدار داده‌های قدیمی** در صورت خطا در دریافت نرخ‌ها
- **فرم‌های فارسی با اعتبارسنجی** برای ثبت دارایی‌ها و هزینه‌ها
- **محاسبه خودکار معادل تومانی** و نمایش اعداد با ارقام فارسی
- **دفترچه هزینه‌ها با امکان حذف و بازگردانی**
- **امکان ورود و خروج فایل JSON** برای دارایی‌ها و هزینه‌ها
- **ذخیره‌سازی محلی (LocalStorage) با همگام‌سازی اختیاری Supabase**

## آزمون و پذیرش

برای بررسی دستی معیارهای پذیرش:

1. برنامه را اجرا کنید و یک دارایی و هزینه اضافه کنید؛ کارت‌های خلاصه باید جمع کل و اختلاف را نمایش دهند.
2. در بخش هزینه‌ها مقدار ارزی را تغییر دهید تا معادل تومانی لحظه‌ای به‌روزرسانی شود.
3. نرخ‌ها را چند بار به‌روزرسانی کنید (یا فایل API را Mock کنید) تا تغییر نرخ‌ها در کارت خلاصه قابل مشاهده باشد.
4. اتصال اینترنت را قطع یا مقدار API key را اشتباه کنید تا بنر «داده قدیمی» فعال شود.
5. جهت صفحه و چینش‌ها باید راست‌به‌چپ باشد و همه متون به فارسی نمایش داده شوند.
6. از گزینه‌های خروجی JSON استفاده و فایل را دوباره وارد کنید تا اطلاعات بازگردد.

## ساختار پوشه‌ها

- `app/` – صفحات App Router، چیدمان و API ها
- `components/` – اجزای رابط کاربری
- `hooks/` – هوک‌های مدیریت وضعیت و همگام‌سازی
- `lib/` – توابع کمکی برای نرخ، قالب‌بندی و Supabase
- `public/` – دارایی‌های استاتیک (در حال حاضر خالی)

## مجوز

این پروژه تحت مجوز MIT ارائه می‌شود.
